// محاكاة لخدمة التعرف الضوئي على الحروف (OCR) للصور
export class ImageOCR {
  static async extractTextFromImage(file: File): Promise<string> {
    // هذا الجزء يحاكي عملية OCR حقيقية.
    // في تطبيق حقيقي، ستحتاج إلى استخدام مكتبات مثل Tesseract.js (للمتصفح)
    // أو خدمات OCR سحابية مثل Azure Form Recognizer أو Google Cloud Vision AI.

    // قراءة الملف كـ Data URL
    const reader = new FileReader()
    reader.readAsDataURL(file)

    return new Promise((resolve, reject) => {
      reader.onload = async () => {
        const base64Image = reader.result as string

        // محاكاة استخراج النص بناءً على اسم الملف أو نوعه
        let mockText = ""
        const fileName = file.name.toLowerCase()

        if (fileName.includes("دعوى") || fileName.includes("صورة-دعوى")) {
          mockText = `
            صورة ضوئية لصحيفة دعوى مدنية

            إلى السيد رئيس المحكمة الابتدائية بصنعاء المحترم

            المدعي: علي عبد الله صالح
            العنوان: شارع الزبيري - صنعاء
            الهاتف: 777987654

            المدعى عليه: حسين قاسم العبسي
            العنوان: حي سعوان - صنعاء

            موضوع الدعوى: المطالبة بدين مستحق

            الوقائع:
            1. أن المدعي أقرض المدعى عليه مبلغ 1,000,000 ريال يمني بتاريخ 01/03/2023.
            2. تم تحرير سند دين بذلك يستحق السداد بتاريخ 01/03/2024.
            3. رفض المدعى عليه السداد رغم المطالبات المتكررة.

            المطالب:
            1. إلزام المدعى عليه بدفع مبلغ 1,000,000 ريال يمني.
            2. إلزام المدعى عليه بالمصروفات والأتعاب.

            التوقيع: علي عبد الله صالح
            التاريخ: 10/04/2024
          `
        } else if (fileName.includes("عقد") || fileName.includes("صورة-عقد")) {
          mockText = `
            صورة ضوئية لعقد إيجار

            أنه في يوم الثلاثاء الموافق 10/01/2022

            تم بين كل من:
            المؤجر: سعيد ناصر القاضي
            المستأجر: فهد علي السقاف

            إيجار شقة سكنية في حي حدة - صنعاء
            المساحة: 120 متر مربع
            الحدود: شمالاً شارع فرعي، جنوباً منزل مجاور، شرقاً مسجد، غرباً حديقة

            الأجرة المتفق عليها: 70,000 ريال يمني شهرياً
            مدة الإيجار: سنتان تبدأ من 10/01/2022 وتنتهي في 09/01/2024

            توقيع المؤجر: سعيد ناصر القاضي
            توقيع المستأجر: فهد علي السقاف
          `
        } else {
          mockText = `
            هذه صورة لمستند غير محدد، النص المستخرج قد يكون غير كامل.
            تاريخ: 05/05/2023
            مبلغ: 5000 دولار
            موقع: عدن
            أطراف: طرف أول، طرف ثاني
          `
        }

        // تأخير بسيط لمحاكاة عملية OCR
        await new Promise((res) => setTimeout(res, 1500))
        resolve(mockText.trim())
      }
      reader.onerror = reject
    })
  }
}
